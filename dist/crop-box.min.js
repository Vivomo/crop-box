!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).CropBox=i()}(this,function(){"use strict";let t=function(t){this.options=Object.assign({},this.defaultConfig,t),this.init()};return t.prototype={constructor:t,hidden:!1,defaultConfig:{minWidth:5,minHeight:5,ratio:null},cropperTemplate:'\n  <div class="cropper">\n            <div class="square s-lt" data-left="1" data-top="1"></div>\n            <div class="square s-t" data-top="1"></div>\n            <div class="square s-rt" data-width="1" data-top="1"></div>\n            <div class="square s-l" data-left="1"></div>\n            <div class="square s-r" data-width="1"></div>\n            <div class="square s-lb" data-left="1" data-height="1"></div>\n            <div class="square s-rb" data-width="1" data-height="1"></div>\n            <div class="square s-b" data-height="1"></div>\n        </div>\n',init:function(){this.initStyle(),this.initListener()},initListener:function(){this.listenCropper(),this.listenCropperItem()},listenCropper:function(){let t=0,i=0,e=0,s=0;this.cropper.addEventListener("mousedown",h=>{t=h.clientX,i=h.clientY,e=this.left,s=this.top,this.updateWrapData();let o=e=>{let s=e.clientX,h=e.clientY;this.move(t-s,i-h),t=s,i=h,e.preventDefault()},n=()=>{document.body.removeEventListener("mousemove",o),document.body.removeEventListener("mouseup",n)};document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",n)})},listenCropperItem:function(){let t=0,i=0,e=0,s=0;Array.from(this.cropper.querySelectorAll(".square")).forEach(o=>{o.addEventListener("mousedown",n=>{n.stopPropagation(),t=n.clientX,i=n.clientY,e=this.left,s=this.top,this.updateWrapData();let a=t=>{h(t,o.dataset),t.preventDefault()},p=()=>{document.body.removeEventListener("mousemove",a),document.body.removeEventListener("mouseup",p)};document.body.addEventListener("mousemove",a),document.body.addEventListener("mouseup",p)})});let h=(e,s)=>{let h=e.clientX,o=e.clientY,n=h-t,a=o-i;s.left&&this.setLeft(this.left+n),s.top&&this.setTop(this.top+a),s.width&&this.setWidth(this.width+n),s.height&&this.setHeight(this.height+a),this.updateCropperPosition(),t=h,i=o}},initStyle:function(){this.initWrap(),this.initCropperStyle()},initWrap:function(){this.elem=this.options.elem;let t=this.wrap=document.createElement("div");t.className="cropper-wrap",t.innerHTML=this.cropperTemplate,this.cropper=t.querySelector(".cropper"),this.options.hide&&this.hide(),this.elem.appendChild(t)},initCropperStyle:function(){this.updateWrapData();let t=Math.min(this.wrapWidth,this.wrapHeight)/4;this.left=~~((this.wrapWidth-t)/2),this.top=~~((this.wrapHeight-t)/2),this.width=t,this.height=this.options.ratio?this.width/this.options.ratio:t,this.updateCropperPosition()},hide:function(){this.wrap.classList.add("hide"),this.hidden=!0},show:function(){this.hidden=!1,this.wrap.classList.remove("hide")},updateWrapData:function(){this.wrapWidth=this.elem.clientWidth,this.wrapHeight=this.elem.clientHeight},updateCropperPosition:function(){this.cropper.style.cssText=`\n            left: ${this.left}px;\n            width: ${this.width}px;\n            top: ${this.top}px;\n            height: ${this.height}px;\n            `},move:function(t,i){this.setLeft(this.left-t,!1),this.setTop(this.top-i,!1),this.updateCropperPosition()},setLeft:function(t,i=!0,e=!1){let s=this.left;this.left=Math.max(Math.min(i?this.left+this.width-this.options.minWidth:this.wrapWidth-this.width,t),0),i&&this.setWidth(this.width+(s-this.left)),e&&this.updateCropperPosition()},setTop:function(t,i=!0,e=!1){let s=this.top;this.top=Math.max(Math.min(i?this.top+this.height-this.options.minHeight:this.wrapHeight-this.height,t),0),i&&this.setHeight(this.height+(s-this.top)),e&&this.updateCropperPosition()},setWidth:function(t,i=!1,e=!1){let s=Math.max(this.options.minWidth,Math.min(t,this.getMaxWidth()));if(this.options.ratio&&!e){let t=s/this.options.ratio,i=this.getMaxHeight();t>i&&(s=(t=i)*this.options.ratio),this.setHeight(t,!1,!0)}this.width=s,i&&this.updateCropperPosition()},getMaxWidth:function(){return this.wrapWidth-this.left},setHeight:function(t,i=!1,e=!1){let s=Math.max(this.options.minHeight,Math.min(t,this.getMaxHeight()));if(this.options.ratio&&!e){let t=s*this.options.ratio,i=this.getMaxWidth();t>i&&(s=(t=i)/this.options.ratio),this.setWidth(t,!1,!0)}this.height=s,i&&this.updateCropperPosition()},getMaxHeight:function(){return this.wrapHeight-this.top},getData:function(){return{left:this.left,top:this.top,width:this.width,height:this.height}}},t});
