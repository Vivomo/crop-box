!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).CropBox=i()}(this,function(){"use strict";var t=function(t){this.options=Object.assign({},this.defaultConfig,t),this.init()};return t.prototype={constructor:t,hidden:!1,defaultConfig:{minWidth:5,minHeight:5,ratio:null},cropperTemplate:'\n  <div class="cropper">\n            <div class="square s-lt" data-left="1" data-top="1"></div>\n            <div class="square s-t" data-top="1"></div>\n            <div class="square s-rt" data-width="1" data-top="1"></div>\n            <div class="square s-l" data-left="1"></div>\n            <div class="square s-r" data-width="1"></div>\n            <div class="square s-lb" data-left="1" data-height="1"></div>\n            <div class="square s-rb" data-width="1" data-height="1"></div>\n            <div class="square s-b" data-height="1"></div>\n        </div>\n',init:function(){this.initStyle(),this.initListener()},initListener:function(){this.listenCropper(),this.listenCropperItem()},listenCropper:function(){var t=this,i=0,e=0;this.cropper.addEventListener("mousedown",function(s){i=s.clientX,e=s.clientY,t.left,t.top,t.updateWrapData();var o=function(s){var o=s.clientX,h=s.clientY;t.move(i-o,e-h),i=o,e=h,s.preventDefault()};document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",function t(){document.body.removeEventListener("mousemove",o),document.body.removeEventListener("mouseup",t)})})},listenCropperItem:function(){var t=this,i=0,e=0;Array.from(this.cropper.querySelectorAll(".square")).forEach(function(o){o.addEventListener("mousedown",function(h){h.stopPropagation(),i=h.clientX,e=h.clientY,t.left,t.top,t.updateWrapData();var n=function(t){s(t,o.dataset),t.preventDefault()};document.body.addEventListener("mousemove",n),document.body.addEventListener("mouseup",function t(){document.body.removeEventListener("mousemove",n),document.body.removeEventListener("mouseup",t)})})});var s=function(s,o){var h=s.clientX,n=s.clientY,a=h-i,r=n-e;o.left&&t.setLeft(t.left+a),o.top&&t.setTop(t.top+r),o.width&&t.setWidth(t.width+a),o.height&&t.setHeight(t.height+r),t.updateCropperPosition(),i=h,e=n}},initStyle:function(){this.initWrap(),this.initCropperStyle()},initWrap:function(){this.elem=this.options.elem;var t=this.wrap=document.createElement("div");t.className="cropper-wrap",t.innerHTML=this.cropperTemplate,this.cropper=t.querySelector(".cropper"),this.options.hide&&this.hide(),this.elem.appendChild(t)},initCropperStyle:function(){this.updateWrapData();var t=Math.min(this.wrapWidth,this.wrapHeight)/4;this.left=~~((this.wrapWidth-t)/2),this.top=~~((this.wrapHeight-t)/2),this.width=t,this.height=this.options.ratio?this.width/this.options.ratio:t,this.updateCropperPosition()},hide:function(){this.wrap.classList.add("hide"),this.hidden=!0},show:function(){this.hidden=!1,this.wrap.classList.remove("hide")},updateWrapData:function(){this.wrapWidth=this.elem.clientWidth,this.wrapHeight=this.elem.clientHeight},updateCropperPosition:function(){this.cropper.style.cssText="\n            left: "+this.left+"px;\n            width: "+this.width+"px;\n            top: "+this.top+"px;\n            height: "+this.height+"px;\n            "},move:function(t,i){this.setLeft(this.left-t,!1),this.setTop(this.top-i,!1),this.updateCropperPosition()},setLeft:function(t,i,e){void 0===i&&(i=!0),void 0===e&&(e=!1);var s=this.left;this.left=Math.max(Math.min(i?this.left+this.width-this.options.minWidth:this.wrapWidth-this.width,t),0),i&&this.setWidth(this.width+(s-this.left)),e&&this.updateCropperPosition()},setTop:function(t,i,e){void 0===i&&(i=!0),void 0===e&&(e=!1);var s=this.top;this.top=Math.max(Math.min(i?this.top+this.height-this.options.minHeight:this.wrapHeight-this.height,t),0),i&&this.setHeight(this.height+(s-this.top)),e&&this.updateCropperPosition()},setWidth:function(t,i,e){void 0===i&&(i=!1),void 0===e&&(e=!1);var s=Math.max(this.options.minWidth,Math.min(t,this.getMaxWidth()));if(this.options.ratio&&!e){var o=s/this.options.ratio,h=this.getMaxHeight();o>h&&(s=(o=h)*this.options.ratio),this.setHeight(o,!1,!0)}this.width=s,i&&this.updateCropperPosition()},getMaxWidth:function(){return this.wrapWidth-this.left},setHeight:function(t,i,e){void 0===i&&(i=!1),void 0===e&&(e=!1);var s=Math.max(this.options.minHeight,Math.min(t,this.getMaxHeight()));if(this.options.ratio&&!e){var o=s*this.options.ratio,h=this.getMaxWidth();o>h&&(s=(o=h)/this.options.ratio),this.setWidth(o,!1,!0)}this.height=s,i&&this.updateCropperPosition()},getMaxHeight:function(){return this.wrapHeight-this.top},getData:function(){return{left:this.left,top:this.top,width:this.width,height:this.height}}},t});
